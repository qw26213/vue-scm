<script src="static/js/plugins/jquery.dataTables.min.js"></script>
<style>
.table>thead>tr>th {text-align: center;}
</style>
<div class="bw100 urel">
    <div class="plr15 ov-y bgb pb15" style="height:100%;">
        <div class="clearfix mt10">
            <form id="searchForm" class="clearfix urel search-content" style="width:1080px">
            	<input id="PDF" name="PDF" type="hidden" value="0"/>            
                <div class="form-group uds">
                    <div class="form-group uds">
	                    <label class="uds">统计日期:</label>
	                    <div class="input-group date uds urel">
	                        <input type="text" class="form-control w120 h28 dataTime1" name="jeDate1" id="jeDate1" />
	                        <div class="date_icon" onclick="showDate(this)"></div>
	                    </div>
	                    <label>&nbsp;&nbsp;&nbsp;&nbsp;统计:</label>
	                  	<select id="queryValueType" class="form-control w90 h28 uds p0" name="queryValueType">
							<option value="毛利"  selected="selected">毛利</option>
	                    	<option value="收入">收入</option>
	                        <option value="销售数量">销售数量</option>
	                        <option value="销售单价">销售单价</option>
	                        <option value="成本">成本</option>
	                        <option value="采购数量">采购数量</option>
	                        <option value="采购单价">采购单价</option>
							<option value="毛利率">毛利率</option>
	                    </select>
		                <label class="ml10">&nbsp;&nbsp;&nbsp;&nbsp;显示合计:</label>
	    	            <input class="uds mt0 ml05" id="rollUp" name="rollUp" checked type="checkbox" checked value="1"/>
	    	            <label class="ml10">&nbsp;&nbsp;&nbsp;&nbsp;合计行在前:</label>
	    	            <input class="uds mt0 ml05" id="firstDispTotal" name="firstDispTotal" checked type="checkbox" value="1"/>
	    	            <label class="ml10">&nbsp;&nbsp;&nbsp;&nbsp;横向打印:</label>
	    	            <input class="uds mt0 ml05" id="rotate" name="rotate" checked type="checkbox" value="1"/>
	    	            &nbsp;&nbsp;&nbsp;&nbsp;
			       		
	    	            <button type="button" class="btn btn-wrap plr20 ufr"  onclick="exportExcel()">导出</button>	    	            	    	            	    	            
	    	            <button type="button" class="btn btn-wrap plr20 ufr"  onclick="printChart()">打印</button>
	    	            <button type="button" class="btn btn-search plr20 ufr"  onclick="queryGrossProfit()">查询</button>			       		
					</div>	
	                <br />
	                <div class="form-group uds" id="showGroupType">
						<label class="uds">一级汇总:</label>
	   					<input type="radio" class="uinline-block mr05" id="dept_1" name="group_type" onchange="typeChanged(this)" value="dept" checked="checked"/>网点
	  					<input type="radio" class="uinline-block mr05" id="staff_1" name="group_type" onchange="typeChanged(this)" value="staff" />销售员
	   					<input type="radio" class="uinline-block mr05" id="item_1" name="group_type" onchange="typeChanged(this)" value="item" />产品
	   					<input type="radio" class="uinline-block mr05" id="inv_1" name="group_type" onchange="typeChanged(this)" value="inv" />品类
					</div>

	                <div class="form-group uds" id="showType">
	                	<label class="uds">二级汇总:</label>
	           			<input type="radio" class="uinline-block mr05" id="dept_2" name="type" disabled="disabled" value="dept" />网点
	           			<input type="radio" class="uinline-block mr05" id="staff_2" name="type" value="staff" />销售员
	           			<input type="radio" class="uinline-block mr05" id="item_2" name="type" value="item" />产品        
	           			<input type="radio" class="uinline-block mr05" id="inv_2" name="type" checked="checked" value="inv" />品类
	                </div>
	                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                   	<label class="uds">品类级次:</label>
	                <select id="invCatgLevel" class="form-control w60 h28 uds p0" name="invCatgLevel" onchange="initDataTables2()">
                        <option value="1" selected>一级</option>
                        <option value="2">二级</option>
                        <option value="3">三级</option>
                        <option value="4">四级</option>
                        <option value="5">五级</option>
                        <option value="">末级</option>
                    </select>
	                <i class="red" onclick="alertInfo('选择一至五级只统计产品所属本级的数据,选择末级统计产品所属最末品级的数据。')">!</i>
	       		</div>
            </form>
        </div>
        <table id="dataTable" class="table table-striped table-bordered printThis">
	     	<thead>
    	 	</thead>
 		</table>
    </div>
</div>
<script  type="text/javascript">
var dataTable=null;
var columns=null;
var dataSet=null;
var count=0;
var grossProfitList;
initDatepicker('#jeDate1');

function typeChanged() {
	var radioGroupType = document.getElementsByName("group_type");
	for(var i = 0;i<radioGroupType.length;i++){
		if(radioGroupType[i].checked==true){
			valueGroupType = radioGroupType[i].value;
			break;
		}
	}
	var radioType = document.getElementsByName("type");
	for(var i = 0;i<radioType.length;i++){
		if(radioType[i].checked==true){
			valueType = radioType[i].value;
			break;
		}
	}

	if('dept'==valueGroupType){
	    $("#dept_2").attr("disabled",true);
	    $("#staff_2").attr("disabled",false);
	    $("#item_2").attr("disabled",false);
	    $("#inv_2").attr("disabled",false);
	}else if('staff'==valueGroupType){
	    $("#dept_2").attr("disabled",false);
	    $("#staff_2").attr("disabled",true);
	    $("#item_2").attr("disabled",false);
	    $("#inv_2").attr("disabled",false);
	}else if('item'==valueGroupType){
	    $("#dept_2").attr("disabled",false);
	    $("#staff_2").attr("disabled",false);
	    $("#item_2").attr("disabled",true);
	    $("#inv_2").attr("disabled",true);
	}else if('inv'==valueGroupType){
	    $("#dept_2").attr("disabled",false);
	    $("#staff_2").attr("disabled",false);
	    $("#item_2").attr("disabled",false);
	    $("#inv_2").attr("disabled",true);
	}
	
	if(valueType==valueGroupType){
		if('dept'==valueType){
			$("#dept_2").prop("checked",false);
			$("#staff_2").prop("checked",true);
			$("#item_2").prop("checked",false);
			$("#inv_2").prop("checked",false);
		}else if('staff'==valueType||'item'==valueType||'inv'==valueType){
			$("#dept_2").prop("checked",true);
			$("#staff_2").prop("checked",false);
			$("#item_2").prop("checked",false);
			$("#inv_2").prop("checked",false);
		}
	}
}

function queryGrossProfit() {
    var searchData = $("#searchForm").formToObj();
    if (dataTable!=null) {  
        dataTable.fnClearTable();    //清空数据
        dataTable.fnDestroy();         //销毁
    	dataTable.empty();
    } 

    $.ajax({
        url: ip_url+"gp/grossprofit/todayGrossProfitRotation",
		dataType : "json",
		type : "POST",
		async: false,
        data :JSON.stringify(searchData),
        contentType : "application/json; charset=utf-8",
		success : function(res){
			if(res!=null){
				var count= res.data;
				if(count!=null&&count!='0'&&count>0){
					columns=res.columns;
					dataSet=res.dataSet;
					refressData(columns,dataSet);
				}else{
			         layer.msg("无数据",{icon:5});
				}
			}
		},
		error : function(e) {
			layer.alert("获取表头信息失败");
		}
	});
}
function refressData(columns,dataSet){
	dataTable=$('#dataTable').dataTable({
    	destroy:true,
        bSort: !$('input[name=rollUp]').is(':checked'), //是否启动各个字段的排序功能
        bFilter: false, //是否启动过滤、搜索功能
        lengthChange: false, //是否允许用户自定义每页显示数量
        iDisplayLength: 50, //默认显示的记录数
        oLanguage: {
            sProcessing: "正在获取数据，请稍后...",
            sZeroRecords: "无数据!",
            sInfo : "共 _TOTAL_ 条",
            sInfoEmpty: "记录数为0",
            oPaginate: {
                "sFirst": "第一页",
                "sPrevious": "上一页",
                "sNext": "下一页",
                "sLast": "最后一页"
            }
        },
        "createdRow" : function(row) {//数字右对齐
        	$(row).children("td").each(
        		function(index) {
        			if (index==0) {
        				$(this).css("padding", "0px").css("padding-top", "8px").css("padding-bottom", "8px").css("padding-right", "8px").css("text-align","center");
        			}else{
        				$(this).css("padding", "0px").css("padding-top", "8px").css("padding-bottom", "8px").css("padding-right", "8px").css("text-align","right");
        			}
        			$(this).css("vertical-align","middle");//上下居中
        		}
        	);
        },
        data: dataSet,
        columns: columns,
        fnDrawCallback: function(oSettings) {
            $('#' + oSettings.sTableId).css("width", "100%");
        }
    });
}

function printChart(){
    var data = $("#searchForm").formToObj();
    var exportUrl=ip_url+"gp/grossprofit/printGrossProfit1";
    $.ajax({
        url: exportUrl,
        dataType: "json",
        data: JSON.stringify(data),
        type: "post",
        async: true,
        contentType: "application/json; charset=utf-8",
        success: function(res) {
            if (res.errorCode=="0") {
                window.open("http://"+window.location.host+res.body);
            } else {
                layer.msg(res.msg,{icon:5});
            }
        },
        error: function(e) {
        	 layer.alert("系统错误!");
        }
    });
}

function exportExcel() {
    var data = $("#searchForm").formToObj();
    var exportUrl=ip_url+"gp/grossprofit/exportGrossProfit1";
    var temp = document.createElement("form");
    temp.action = exportUrl;
    temp.method = "POST";
    // temp.target = "_blank";
    temp.style.display = 'none';
    for (var x in data) {
        var opt = document.createElement("textarea");
        opt.name = x;
        opt.value = data[x];
        temp.appendChild(opt);
    }
    document.body.appendChild(temp);
    temp.submit();
    return temp;
}

</script>
