<div class="bw100 urel">
    <div class="plr15 ov-y bgb pb15" style="height:100%;">
        <div class="clearfix mt10">
            <form id="searchForm" class="clearfix urel search-content" style="width:1080px">
                <div class="form-group uds">
                    <label class="uds">统计日期:</label>
                    <div class="input-group date uds urel">
                        <input type="text" class="form-control w120 h28 dataTime1" name="jeDate1" id="jeDate1" readonly>
                        <div class="date_icon" onclick="showDate(this)"></div>
                    </div>
                    <span>至</span>
                    <div class="input-group date uds urel">
                        <input type="text" class="form-control w120 h28 dataTime2" name="jeDate2" id="jeDate2" readonly>
                        <div class="date_icon" onclick="showDate(this)"></div>
                    </div>
                    <label class="ml10">&nbsp;&nbsp;&nbsp;&nbsp;统计零收入:</label>
                    <input class="uds mt0 ml05" id="isSumZeroIncome" name="isSumZeroIncome" type="checkbox" value="1"/>
                    
                    <label class="ml10">&nbsp;&nbsp;&nbsp;&nbsp;统计零成本:</label>
                    <input class="uds mt0 ml05" id="isSumZeroCost" name="isSumZeroCost" type="checkbox" checked value="1"/>
                    
                    <label class="ml10">&nbsp;&nbsp;&nbsp;&nbsp;品类统计时按末级品类:</label>
                    <input class="uds mt0 ml05" id="isLeaf" name="isLeaf" type="checkbox" value="1"/>
                    <label class="ml10">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;保存选择:</label>
                    <input class="uds mt0 ml05" id="saveConf" name="saveConf" type="checkbox" value="1" />
                </div>
                <div class="form-group uds">                    
                    <label>一级汇总:</label>
                    <select id="param1" name="param1" class="form-control w90 h28 uds p0 selectLIst"></select>
                    <label class="ml10">二级汇总:</label>
                    <select id="param2" name="param2" class="form-control w90 h28 uds p0 selectLIst"></select>
                    <label class="ml10">三级汇总:</label>
                    <select id="param3" name="param3" class="form-control w90 h28 uds p0 selectLIst"></select>
                    <label class="ml10">四级汇总:</label>
                    <select id="param4" name="param4" class="form-control w90 h28 uds p0 selectLIst"></select>
                    <label class="ml10">五级汇总:</label>
                    <select id="param5" name="param5" class="form-control w90 h28 uds p0 selectLIst"></select>
                </div>
                <style>.uhideM {display: none!important;}</style>   
                <div class="form-group uds uhideM">                
                    <label>显示列:</label>
                    <input id="column1" name="column1" class="uds mt0 ml10" type="checkbox" disabled value="1" />
                    <i class="uds">列1</i>
                    <input id="column2" name="column2" class="uds mt0 ml10" type="checkbox" disabled value="1" />
                    <i class="uds">列2</i>
                    <input id="column3" name="column3" class="uds mt0 ml10" type="checkbox" disabled value="1" />
                    <i class="uds">列3</i>
                    <input id="column4" name="column4" class="uds mt0 ml10" type="checkbox" disabled value="1" />
                    <i class="uds">列4</i>
                    <input id="column5" name="column5" class="uds mt0 ml10" type="checkbox" disabled value="1" />
                    <i class="uds">列5</i>
                </div>
            </form>
            
            <div class="btn btn-search plr20 ufl" style="padding-top:15px;padding-bottom:15px;" onclick="reGetDataTables()">查询</div>
        </div>
        <table id="dataTable" class="table table-striped table-bordered printThis" cellspacing="0" width="100%"></table>
    </div>
</div>
<script  type="text/javascript">
var dataTable;
initDatepicker('#jeDate1',-1);
initDatepicker('#jeDate2',-1);

getList();
getConf();
function getList(){
    $.ajax({
        dataType: 'json',
        contentType: "application/json",
        type: "POST",
        url: ip_url+'gp/grossprofit/getAggregate',
        async: false,
        success: function(res){
            var optionHtml = '';
            for(var i=0;i<res.length;i++){
                optionHtml+='<option value="'+res[i]+'">'+res[i]+'</option>';
            }
            $('.selectLIst').html(optionHtml);
        },
       	error: function() {
            logout_login("请重新登录");
        }

    });
}
function getConf(){
    var searchData = $("#searchForm").formToObj();
    $.ajax({
        dataType: 'json',
        contentType: "application/json",
        type: "POST",
        url: ip_url+'gp/grossprofit/getConf0001',
        data: JSON.stringify(searchData),  
        async: false,
        success: function(res){
            setParam(res.body);
            initDataTables();
        },
       	error: function() {
            logout_login("请重新登录");
        }
    });
}
function setParam(map){
    if(map==null){
        return;
    }
    $("#column1").prop("checked",false);
	$("#column2").prop("checked",false);
	$("#column3").prop("checked",false);
	$("#column4").prop("checked",false);
	$("#column5").prop("checked",false);
    if(map.param1!=null&&map.param1!="----"){
        $("#param1").val(map.param1);
    } 
    else{
        $("#param1").val("----");
    }
    if(map.param2!=null&&map.param2!="----"){
        $("#param2").val(map.param2);
    }
    else{
        $("#param2").val("----");
    }
    if(map.param3!=null&&map.param3!="----"){
        $("#param3").val(map.param3);
	}	
    else{
        $("#param3").val("----");
	}
    if(map.param4!=null&&map.param4!="----"){
        $("#param4").val(map.param4);
	}
	else{
        $("#param4").val("----");
	}
    if(map.param5!=null&&map.param5!="----"){
        $("#param5").val(map.param5);
	}
	else{
        $("#param5").val("----");
	}

    if($("#param1").val()!="----")	
	    $("#column1").prop("checked",true);
    if($("#param2").val()!="----")	
		$("#column2").prop("checked",true);
    if($("#param3").val()!="----")	
		$("#column3").prop("checked",true);
    if($("#param4").val()!="----")	
		$("#column4").prop("checked",true);
    if($("#param5").val()!="----")	
		$("#column5").prop("checked",true);
	
	
    if(map.isSumZeroIncome!=null&&map.isSumZeroIncome=="1")
        $("#isSumZeroIncome").prop("checked",true);
    else
        $("#isSumZeroIncome").prop("checked",false);
    
    if(map.isSumZeroCost!=null&&map.isSumZeroCost=="1")
        $("#isSumZeroCost").prop("checked",true);
    else
        $("#isSumZeroCost").prop("checked",false);
    
    if(map.isLeaf!=null&&map.isLeaf=="1")
        $("#isLeaf").prop("checked",true);
    else
        $("#isLeaf").prop("checked",false);

    //设置参数
}

function initDataTables() {
    dataTable = $("#dataTable").dataTable({
        bSort: false, //是否启动各个字段的排序功能
        bFilter: false, //是否启动过滤、搜索功能
        lengthChange: false, //是否允许用户自定义显示数量
        iDisplayLength:50, //默认显示的记录数
        oLanguage: {
            sProcessing: "正在获取数据，请稍后...",
            sZeroRecords: "无数据!",
            sInfo : "共 _TOTAL_ 条",
            sInfoEmpty: "记录数为0",
            oPaginate: {
                "sFirst": "第一页",
                "sPrevious": "上一页",
                "sNext": "下一页",
                "sLast": "最后一页"
            }
        },
        sAjaxSource: ip_url+"gp/grossprofit/grossProfitVOList",
        fnServerData: function(sSource, aDataSet, fnCallback) {
            var searchData = $("#searchForm").formToObj();
            $.ajax({
                "dataType": 'json',
                "contentType": "application/json",
                "type": "POST",
                "url": sSource,
                "async": false,
                "data": JSON.stringify(searchData),
                "success": fnCallback,
                error : function(e) {
                    logout_login("请重新登录");
                }
            });
        },
        aoColumns: [{
            "mData": "jeDate",
            'bVisible':$('input[name=column1]').is(':checked'),
            'sClass':'tx-c',
            "sTitle": $('#param1').val()
        }, {
            "mData": "invCatgName",
            'bVisible':$('input[name=column2]').is(':checked'),
            'sClass':'tx-c',
            "sTitle": $('#param2').val()
        }, {
            "mData": "itemName",
            'bVisible':$('input[name=column3]').is(':checked'),
            'sClass':'tx-c',
            "sTitle": $('#param3').val()
        }, {
            "mData": "deptName",
            'bVisible':$('input[name=column4]').is(':checked'),
            'sClass':'tx-c',
            "sTitle": $('#param4').val()
        }, {
            "mData": "staffName",
            'bVisible':$('input[name=column5]').is(':checked'),
            'sClass':'tx-c',
            "sTitle": $('#param5').val()
        }, {
            "mData": "uom",
            'sClass':'tx-c',
            "sTitle": "单位"
        }, {
            "mData": "num",
            "sTitle": "数量",
            'sClass':'tx-c',
            "mRender": function(data, type, full) {
                return rightAlign(toFormatStr(data, 2, true, true));
            }
        }, {
            "mData": "price",
            "sTitle": "平均单价",
            'sClass':'tx-c',
            "mRender": function(data, type, full) {
                return rightAlign(toFormatStr(data, 4, true, true));
            }
        }, {
            "mData": "income",
            "sTitle": "收入",
            'sClass':'tx-c',
            "mRender": function(data, type, full) {
                return rightAlign(toFormatStr(data, 2, true, true));
            }
        }, {
            "mData": "cost",
            "sTitle": "成本",
            'sClass':'tx-c',
            "mRender": function(data, type, full) {
                return rightAlign(toFormatStr(data, 2, true, true));
            }
        }, {
            "mData": "grossProfit",
            "sTitle": "毛利",
            'sClass':'tx-c',
            "mRender": function(data, type, full) {
                return rightAlign(toFormatStr(data, 2, true, true));
            }
        }, {
            "mData": "grossProfitMargin",
            "sTitle": "毛利率(%)",
            'sClass':'tx-c',
            "mRender": function(data, type, full) {
                return rightAlign(toFormatStr(data, 2, true, true));
            }
        }],
        fnDrawCallback: function(oSettings) {
            $('#' + oSettings.sTableId).css("width", "100%");
        }
    });
}

// ------查询数据-----
function reGetDataTables() {
	//
    var searchData = $("#searchForm").formToObj();
	setParam(searchData);	
    dataTable.fnDestroy();
    initDataTables();
}

// ------重置表单-----
function resetForm() {
    $('#searchForm')[0].reset();
}

</script>
